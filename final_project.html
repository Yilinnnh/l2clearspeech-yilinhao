<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yilin Hao">
<meta name="keywords" content="L2 speakers, speech production, R programming, ggplot2, data communication">
<meta name="description" content="L2 SPEAKERS’ USE AND MAINTENANCE OF CLEAR SPEECH">

<title>L2 Speakers’ Use and Maintenance of Clear Speech in Natural Conversations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Final_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final_project_files/libs/quarto-html/quarto.js"></script>
<script src="Final_project_files/libs/quarto-html/popper.min.js"></script>
<script src="Final_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="Final_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final_project_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final_project_files/libs/bootstrap/bootstrap-61c9f5fe3bf7f1d5f9219c551e9df0c2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="Final_project_files/libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="Final_project_files/libs/tabwid-1.1.3/tabwid.js"></script>


<link rel="stylesheet" href="_extensions/wjschne/apaquarto/apa.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#methods" id="toc-methods" class="nav-link active" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Final_project.docx"><i class="bi bi-file-word"></i>MS Word (apaquarto)</a></li><li><a href="Final_project.pdf"><i class="bi bi-file-pdf"></i>Typst (apaquarto)</a></li><li><a href="Final_project.pdf"><i class="bi bi-file-pdf"></i>PDF (apaquarto)</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">




<br>

<br>

<section id="title" class="level1 title unnumbered unlisted">
<h1 class="title unnumbered unlisted">L2 Speakers’ Use and Maintenance of Clear Speech in Natural Conversations</h1>
<div class="Author">
<br>

<p>Yilin Hao</p>
<p>MA Program in the Social Sciences, University of Chicago</p>
</div>
</section>
<section id="author-note" class="level1 unnumbered unlisted AuthorNote">
<h1 class="unnumbered unlisted AuthorNote">Author Note</h1>
</section>
<section id="abstract" class="level1 unnumbered unlisted AuthorNote">
<h1 class="unnumbered unlisted AuthorNote">Abstract</h1>
<div class="AbstractFirstParagraph">
<p>This study investigates L2 speakers’ use and maintenance of clear speech in natural conversations.</p>
</div>
<p><em>Keywords</em>: L2 speakers, speech production, R programming, ggplot2, data communication</p>
</section>
<section id="firstheader" class="level1 title unnumbered unlisted">
<h1 class="title unnumbered unlisted">L2 Speakers’ Use and Maintenance of Clear Speech in Natural Conversations</h1>
<p>##Introduction ## Literature Review {#sec-lit-review} Native English speakers often tend to use clear speech to make their speech more intelligible in their conversations with people who may have difficulty understanding their speech, such as non-native speakers. This raises the question: do second language (L2) speakers of English also use clear speech when communicating with other L2 speakers? This proposed study may provide insight into L2 speakers’ use of clear speech in natural conversations, especially whether they will spontaneously adopt this speech style when they are talking to other L2 speakers and their maintenance of this speech style throughout the conversation. Literature review “Clear speech” refers to speakers’ modification of their speech in order to increase the intelligibility for the listener, which includes various acoustic-phonetic changes like slower speech and linguistic adaptations like higher frequency words (Tuomainen et al., 2022). It is usually used by speakers to accommodate noisy environments, listeners with hearing impairments, and non-native listeners (Mattys et al., 2012). In Hazan et al.’s (2018) study of speech adaptation in conversations with adults with hearing loss, they found some significant differences in acoustic features between clear speech and normal speech style, which is also referred to as plain speech, including acoustic cues like articulation rate, mid-frequency range, and vocal effort which reflected by mean energy within the mid-frequency region. The benefit of clear speech has been found to be significant when addressing listeners with impaired hearing (Picheny et al., 1985) and in noisy environments (Calandruccio, 2020). By modifying the acoustic cues, clear speech can greatly improve native speakers’ intelligibility gain (Bradlow and Bent, 2002). Although non-native speakers face different challenges in understanding speech compared to native speakers with hearing impairments or in noisy environments—difficulty accessing the underlying linguistic code rather than the speech signal—researchers found that non-native speakers can still benefit from clear speech with features such as a slower speaking rate and a wider dynamic pitch range (Bradlow and Bent, 2002). Recent studies have shown that clear speech has an overall effect in increasing intelligibility gain regardless of language background, and the benefit difference between l2 speakers and native speakers is not significant (Jung, Dmitrieva, 2023). In addition, L2 speakers with higher fluency in English demonstrate a clear speech benefit that is more comparable to that of native speakers. (Similjanic and Bradlow, 2011). Previous research has shown that besides perceptually benefiting from clear speech, fluent L2 speakers also exhibit the ability to produce effective acoustic-phonetic modifications in their speech and achieve the effect of clear speech (Kato &amp; Baese-Berk, 2022). Although the extent of acoustic modification in their speech differs from that of native speakers, L2 speakers are still able to successfully use clear speech (Jung, Dmitrieva, 2023). By analyzing L2 speakers’ acoustic characteristics while reading given texts in clear and plain speech styles, Jung and Dmitrieva (2023) found that L2 speakers also demonstrated the same clear speech features as native speakers. In other words, L2 speakers exhibited their ability to employ clear speech when they were prompted to do so.</p>
<section id="sec-present-study" class="level2">
<h2 data-anchor-id="sec-present-study">Present Study</h2>
<p>While the prior studies examined the effectiveness of L2 speakers’ clear speech and the perceptual benefit of clear speech for L2 speakers using artificial methods where there’s no actual conversation, there are few studies that examined L2 speakers’ use of clear speech in natural conversations (Similjanic and Bradlow, 2011; Bradlow and Bent, 2002). Previous studies have illustrated that native speakers’ clear speech exhibits greater hyperarticulation under artificial methods, where participants are instructed to read texts in a clear speech style, compared to their clear speech produced in natural conversations (Hazan and Baker, 2011). Therefore, in natural conversations, L2 speakers’ use of clear speech and its effectiveness may also differ from their performance in artificial contexts. The present study aims to explore whether L2 speakers will spontaneously use clear speech while talking to someone who may have difficulty understanding them— in this study, other non-native speakers— and whether they maintain this use throughout the conversation. Specifically, the present study aims to answer the following questions: whether L2 speakers will show clear speech characteristics like lower articulation rate, higher F0, and higher mean energy of mid-frequency region (Hazan et al., 2018) in their conversation with other L2 speakers in comparison with their conversation with native speakers, and whether these characteristics persist from the early to the later stages of the conversation. We hypothesize that L2 speakers will use clear speech when interacting with another L2 speaker, indicating their purpose of making their speech more intelligible to non-native listeners (Mattys et al., 2012). If the hypothesis is true, then native speakers’ speech is expected to show modifications including slower speech rate, greater F0, and higher mean energy in the mid-frequency region during their conversations with L2 speakers compared to their conversations with native speakers (Hazan et al., 2018). Furthermore, if L2 speakers tend to maintain using clear speech throughout the conversation to meet the intelligibility needs of listeners, they will continue showing these features throughout the speech. Lee and Baese-Berk(2020) found that native speakers’ clear speech became less intelligible in the later portions of a conversation but reset to clear speech at the beginning of the next conversation, which suggests that even though the use of clear speech is oriented by listeners’ needs, native speakers do not monitor their listener throughout the conversation. Therefore, it is possible that L2 speakers may use clear speech at an earlier stage of their conversation and become less clear later, which can suggest that the maintenance of clear speech is speaker-driven even though the use of clear speech is mostly listener-driven (Lee &amp; Baese-Berk, 2020). An alternative hypothesis is that they will use plain speech style when they communicate with L2 speakers, thus their acoustic cues and speech signals would not have significant differences when talking to both L2 and native speakers, which can reflect their assumption that their listeners have no problem understanding them.</p>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>Participants Participants were students recruited from Northwestern University, including native speakers of English and L2 speakers. L2 speakers were included if they were non-native speakers who could also speak English and demonstrate proficiency in English. These participants had been in the U.S. for no more than 3 years and had achieved TOEFL scores of at least 600 for the paper-based test, 250 for the computer-based test, or 100 for the internet-based test (Van Engen et al., 2010). Materials This study will analyze conversations recorded during Diapix tasks, drawn from the Wildcat Corpus (Van Engen et al., 2010). The Diapix task requires two participants to identify differences in a pair of pictures. Each pair of pictures presents the same general scene but with 10 differences: each picture has three items that are missing from the other, and there are four slight differences between the two pictures (“change” items, such as differences in color or other details) (Van Engen et al., 2010). Each participant will be able to see one of a pair of pictures and they are asked to identify all the differences by verbal communication with their partner. Procedure Participants completed the Diapix task in two groups. One group involves pairs of two L2 speakers, and the second group involves pairs of one L2 speaker with a native English speaker. Participants sat back-to-back in a recording room where they could communicate but could not see each other’s pictures. They were instructed to work collaboratively through conversation to identify all the differences in their pictures within 20 minutes and mark them by drawing circles or notes, etc. They wore headsets so their speeches will be recorded separately. Data Analysis Recording of participants’ speech will be transcribed using the phonetic analysis software Praat. The articulation rate will be calculated by the number of syllables produced in speech divided by the total duration of the speech. The mean energy and fundamental frequency will be measured by Praat. The independent variables will be different kinds of participant pairing, including one native speaker and one L2 speaker or two L2 speakers, and different stages of conversation (early or late). We will compare the F0, mean energy, and articulation rate of L2 speakers’ speech between these two groups, either talking to L2 speakers or native speakers. In addition, we will examine how these features vary between the early and late stages of the conversation. The greater F0, mean energy, and slower articulation rate are going to be the indicators of clear speech. The results will be analyzed using R with separate linear mixed-effects regression models.</p>
<section id="results" class="level2">
<h2 data-anchor-id="results">Results</h2>
<div class="cell FigureWithNote" data-apa-note="F0 (Hz), F0 Range (Hz), Speech Rate (syllables per second), Vowel Duration (s)" prefix="" data-tblnum="1" data-custom-style="FigureWithNote">
<div id="tbl-earlydata" class="cell quarto-float quarto-figure quarto-figure-center" data-apa-note="F0 (Hz), F0 Range (Hz), Speech Rate (syllables per second), Vowel Duration (s)" prefix="" data-tblnum="1">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-earlydata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Table&nbsp;1</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Table I.</p>
</div>
</figcaption>
<div aria-describedby="tbl-earlydata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-71186c3c{}.cl-711075b8{font-family:'Times New Roman';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-711406d8{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 2;background-color:transparent;}.cl-7114229e{width:3in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-711422a8{width:1.5in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0.75pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-711422a9{width:3in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-711422aa{width:1.5in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-711422b2{width:3in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-711422b3{width:1.5in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-71186c3c"><thead><tr style="overflow-wrap:break-word;"><th class="cl-7114229e"><p class="cl-711406d8"><span class="cl-711075b8">Conversation Partner</span></p></th><th class="cl-711422a8"><p class="cl-711406d8"><span class="cl-711075b8">F0</span></p></th><th class="cl-711422a8"><p class="cl-711406d8"><span class="cl-711075b8">F0 range</span></p></th><th class="cl-711422a8"><p class="cl-711406d8"><span class="cl-711075b8">Speech Rate</span></p></th><th class="cl-711422a8"><p class="cl-711406d8"><span class="cl-711075b8">Vowel Duration</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-711422a9"><p class="cl-711406d8"><span class="cl-711075b8">L2 Speaker with Different L1</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">199.96</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">32.72</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">3.19</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">0.14</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-711422a9"><p class="cl-711406d8"><span class="cl-711075b8">L2 Speaker with Same L1</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">169.22</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">23.84</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">3.16</span></p></td><td class="cl-711422aa"><p class="cl-711406d8"><span class="cl-711075b8">0.14</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-711422b2"><p class="cl-711406d8"><span class="cl-711075b8">Native Speaker</span></p></td><td class="cl-711422b3"><p class="cl-711406d8"><span class="cl-711075b8">160.19</span></p></td><td class="cl-711422b3"><p class="cl-711406d8"><span class="cl-711075b8">25.25</span></p></td><td class="cl-711422b3"><p class="cl-711406d8"><span class="cl-711075b8">2.88</span></p></td><td class="cl-711422b3"><p class="cl-711406d8"><span class="cl-711075b8">0.14</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
<div class="FigureNote" data-custom-style="FigureNote">
<p><em>Note</em>. F0 (Hz), F0 Range (Hz), Speech Rate (syllables per second), Vowel Duration (s)</p>
</div>
</div>
<div class="cell FigureWithNote" data-apa-note="F0 (Hz) for each group." data-custom-style="FigureWithNote">
<div class="cell-output-display">
<div id="fig-f0-boxplot" class="quarto-float quarto-figure quarto-figure-center" data-fignum="1" prefix="">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-f0-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Figure&nbsp;1</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Fig. I</p>
</div>
</figcaption>
<div aria-describedby="fig-f0-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final_project_files/figure-html/fig-f0-boxplot-1.svg" class="img-fluid figure-img" width="768">
</div>
</figure>
</div>
</div>
</div>
<div class="FigureNote" data-custom-style="FigureNote">
<p><em>Note</em>. F0 (Hz) for each group.</p>
</div>
<div class="cell FigureWithNote" data-apa-note="F0 Range (Hz) for each group." data-custom-style="FigureWithNote">
<div class="cell-output-display">
<div id="fig-f0range-boxplot" class="quarto-float quarto-figure quarto-figure-center" data-fignum="2" prefix="">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-f0range-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="FigureTitle" data-custom-style="FigureTitle">
<p>Figure&nbsp;2</p>
</div>
<div class="Caption" data-custom-style="Caption">
<p>Fig. II</p>
</div>
</figcaption>
<div aria-describedby="fig-f0range-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final_project_files/figure-html/fig-f0range-boxplot-1.svg" class="img-fluid figure-img" width="768">
</div>
</figure>
</div>
</div>
</div>
<div class="FigureNote" data-custom-style="FigureNote">
<p><em>Note</em>. F0 Range (Hz) for each group.</p>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>